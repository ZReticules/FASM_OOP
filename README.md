# FASM_OOP  
Расширение стандартных структур FASM-а с помощью макросов до функционала классов(без области видимости)  
На данный момент реализованы виртуальные и статические методы, привязка константных значений  
Синтаксис следующий:  
	struct name [parent]  
		method1 method procname[:virtual]  
		...  
	ends  
Если имя метода имеет имя формата strutname.methodname, то вместо procname можно указывать this. Для виртуальных методов на смещении 8 байт сзади от обьекта создается указатель на таблицу виртуальных методов, если обьект или его предок имел такие методы. Сама таблица создается сразу после определения структуры. Ключ :virtual обозначает, что метод виртуальный и будет прикреплен к таблице виртуальных методов.  
Для вызова методов(или обычных функций) используется макрос @call. Он имеет следующие варианты синтаксиса:  
1. Для процедур:  
	@call procname([args])  
2. Для указателей на процедуры(в том числе импортируемых из библиотек)  
	@call [procname]([args])   
	*В данном случае [procname] обозначает именно синтаксис, а не необязательность параметра*  
3. Для статических методов при вызове от обьекта  
	@call obj->method([args])  
4. Для виртуальных методов при вызове от обьекта  
	@call [obj->method]([args])  
	*В данном случае [obj->method] обозначает именно синтаксис, а не необязательность параметра*  
5. Для статических методов при вызове от имени структуры  
	@call structname:method([args])  
6. Для виртуальных методов при вызове от имени структуры  
	@call [structname:method]([args])  
	*В данном случае [structname:method] обозначает именно синтаксис, а не необязательность параметра*  
В этом макросе обьект передается в структуру по указателю как первы аргумент - через rcx, последующие аргументы передаются согласно соглашению о вызовах х86_64. Этот макрос может использовать регистр r10 для загрузки указателя на виртуальный метод!  
Для того, чтобы корректно обращаться к полям обьекта было создан макрос virtObj:  
	virtObj name[:arg] type [at addr]  
В случае, если указан ключ :arg, то он выполняет проверку, имеются виртуальные методы или нет. Это предназначено для тех случаев, когда указатель передается непосредственно на сам обьект, из-за чего все поля обьекта могут сместиться на 8 байт, если использовать директиву virtual. Параметр at addr позволяет создать обьект относительно любого адреса, по умолчанию он создается относительно регистра rcx.